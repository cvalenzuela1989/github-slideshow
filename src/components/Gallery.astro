---
import PromoBanner from "./PromoBanner.astro";

// ASTRO FRONTMATTER
const images = [
  '/images/gallery/photo1.jpg',
  '/images/gallery/photo2.jpg',
  '/images/gallery/photo3.jpg',
  '/images/gallery/photo1.jpg',
  '/images/gallery/photo2.jpg',
  '/images/gallery/photo3.jpg',
  '/images/gallery/photo1.jpg',
  '/images/gallery/photo2.jpg',
  '/images/gallery/photo3.jpg',
  '/images/gallery/photo1.jpg',
  '/images/gallery/photo2.jpg',
  '/images/gallery/photo3.jpg',
];
---
<main class="gallery-page">
  <h1 class="magic-title">
    <span class="magic-text">Aquí podrás ver fotos de mi gran día</span>
    <span class="magic-gradient"></span>
  </h1>

  <section class="gallery-carousel" aria-label="Galería de fotos">
    <button id="prevBtn" aria-label="Fotos anteriores" class="btn-carousel">‹</button>

    <div class="gallery-images-wrapper">
      <div class="gallery-images-track">
        {images.map((src, i) => (
          <img
            src={src}
            alt={`Foto ${i + 1}`}
            loading="lazy"
            class="gallery-image"
            data-index={i}
          />
        ))}
      </div>
    </div>

    <button id="nextBtn" aria-label="Fotos siguientes" class="btn-carousel">›</button>
  </section>
  <PromoBanner />
</main>

<style>
  .gallery-page {
    max-width: 1200px;
    margin: 50px auto;
    padding: 3rem 1rem;
    background: rgba(240, 248, 255, 0.3);
    border-radius: 20px;
  }

  .magic-title {
    font-size: 2rem;
    text-align: center;
    margin-bottom: 2rem;
    position: relative;
    font-weight: 700;
    font-family: 'Playfair Display', serif;
    color: #4682B4;
    padding: 1rem;
  }

  .magic-text {
    position: relative;
    z-index: 2;
    text-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }

  .magic-gradient {
    position: absolute;
    inset: 0;
    background: linear-gradient(45deg, #E6F7FF, #4682B4);
    background-size: 300% 300%;
    animation: gradient 8s ease infinite;
    z-index: 1;
    filter: blur(8px);
    opacity: 0.7;
    border-radius: 20px;
    transform: scale(1.05);
  }

  @keyframes gradient {
    0% { background-position: 0% 50% }
    50% { background-position: 100% 50% }
    100% { background-position: 0% 50% }
  }

  .gallery-carousel {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    position: relative;
    width: 100%;
  }

  .btn-carousel {
    background-color: transparent;
    border: 1.5px solid #4682B4;
    color: #4682B4;
    font-size: 1.5rem;
    font-weight: 700;
    cursor: pointer;
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    flex-shrink: 0;
    z-index: 2;
  }

  .btn-carousel:hover {
    background-color: #4682B4;
    color: white;
    box-shadow: 0 0 8px rgba(70,130,180,0.6);
  }

  .gallery-images-wrapper {
    overflow: hidden;
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(135, 206, 235, 0.2);
    width: 100%;
    position: relative;
  }

  .gallery-images-track {
    display: flex;
    gap: 1rem;
    transition: transform 0.5s ease-in-out;
  }

  .gallery-image {
    flex-shrink: 0;
    border-radius: 12px;
    object-fit: contain;
    width: 100%;
    height: auto;
    background-color: #f8f8f8;
    aspect-ratio: 3/4; /* Mantiene relación de aspecto común para fotos */
  }

  /* Versión escritorio - 3 fotos exactas */
  @media (min-width: 968px) {
    .gallery-images-wrapper {
      width: calc(100% - 80px);
      max-width: 1008px; /* 320px * 3 + 24px * 2 */
    }
    
    .gallery-image {
      width: 320px;
      height: 380px;
      min-width: 320px;
      object-fit: cover;
    }

    .btn-carousel {
      width: 40px;
      height: 40px;
      font-size: 2rem;
    }
  }

  /* Versión móvil - 1 foto optimizada */
  @media (max-width: 967px) {
    .gallery-page {
      padding: 2rem 0.5rem;
      margin: 20px auto;
    }

    .magic-title {
      font-size: 1.8rem;
      padding: 0.5rem;
      margin-bottom: 1.5rem;
    }

    .gallery-carousel {
      gap: 0.3rem;
    }

    .gallery-images-wrapper {
      width: calc(100% - 72px);
      height: auto;
      max-height: 70vh;
    }
    
    .gallery-image {
      width: calc(100vw - 72px - 2rem);
      height: auto;
      max-height: 70vh;
      min-width: calc(100vw - 72px - 2rem);
      object-fit: contain;
    }

    .btn-carousel {
      width: 36px;
      height: 36px;
      font-size: 1.5rem;
    }
  }

  /* Para pantallas muy pequeñas */
  @media (max-width: 480px) {
    .gallery-images-wrapper {
      max-height: 60vh;
    }
    
    .gallery-image {
      max-height: 60vh;
    }
  }
</style>

<script is:inline>
  (() => {
    const track = document.querySelector('.gallery-images-track');
    const images = document.querySelectorAll('.gallery-image');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const wrapper = document.querySelector('.gallery-images-wrapper');

    let currentIndex = 0;
    let autoChangeInterval = null;
    let autoChangeTimeout = null;
    let isAutoChanging = false;
    let visibleItems = 3;

    function updateVisibleItems() {
      visibleItems = window.innerWidth < 968 ? 1 : 3;
    }

    function updateCarousel() {
      updateVisibleItems();
      const item = images[0];
      const gap = parseFloat(window.getComputedStyle(track).gap);
      const itemWidth = item.offsetWidth + gap;
      const maxIndex = Math.max(0, images.length - visibleItems);
      
      currentIndex = Math.min(Math.max(0, currentIndex), maxIndex);
      
      track.style.transition = 'transform 0.5s ease-in-out';
      track.style.transform = `translateX(-${currentIndex * itemWidth}px)`;
    }

    function prevSlide() {
      if (isAutoChanging) resetAutoChange();
      currentIndex = Math.max(0, currentIndex - 1);
      updateCarousel();
    }

    function nextSlide() {
      if (isAutoChanging) resetAutoChange();
      const maxIndex = Math.max(0, images.length - visibleItems);
      currentIndex = Math.min(maxIndex, currentIndex + 1);
      updateCarousel();
    }

    function startAutoRotation() {
      isAutoChanging = true;
      autoChangeInterval = setInterval(() => {
        const maxIndex = Math.max(0, images.length - visibleItems);
        currentIndex = currentIndex >= maxIndex ? 0 : currentIndex + 1;
        updateCarousel();
      }, 3000);
    }

    function startAutoChangeDelay() {
      autoChangeTimeout = setTimeout(() => {
        startAutoRotation();
      }, 180000);
    }

    function resetAutoChange() {
      clearInterval(autoChangeInterval);
      clearTimeout(autoChangeTimeout);
      isAutoChanging = false;
      startAutoChangeDelay();
    }

    function handleResize() {
      updateVisibleItems();
      
      if (window.innerWidth >= 968) {
        images.forEach(img => {
          img.style.width = '320px';
          img.style.height = '380px';
          img.style.objectFit = 'cover';
        });
      } else {
        const wrapperWidth = window.innerWidth - 72 - 32; // 72px botones + 32px padding
        images.forEach(img => {
          img.style.width = `${wrapperWidth}px`;
          img.style.height = 'auto';
          img.style.objectFit = 'contain';
        });
      }
      
      updateCarousel();
    }

    prevBtn.addEventListener('click', prevSlide);
    nextBtn.addEventListener('click', nextSlide);
    window.addEventListener('resize', handleResize);

    // Iniciar
    handleResize();
    startAutoChangeDelay();
  })();
</script>